<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Dukcapil Kota Sorong</title>
    <meta name="title" content="Dukcapil Kota Sorong" />
    <meta name="description" content="Website Dukcapil Kota Sorong" />

    <link
      rel="shortcut icon"
      href="../static/assets/footer/logo-removebg-preview.svg"
      type="image/svg+xml"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../static/assets/css/style.css" />
    <link rel="stylesheet" href="../static/assets/css/chatbot.css" />

    <link rel="preload" as="image" href="../static/assets/images/hero-bg.jpg" />
    <link
      rel="preload"
      as="image"
      href="../static/assets/images/hero-slide-1.jpg"
    />
    <link
      rel="preload"
      as="image"
      href="../static/assets/images/hero-slide-2.jpg"
    />
    <link
      rel="preload"
      as="image"
      href="../static/assets/images/hero-slide-3.jpg"
    />
    <style>
    /* Efek kursor berkedip */
    .typing-cursor::after {
      content: "|";
      animation: blink 0.6s infinite;
      color: #2563eb; /* biru */
      margin-left: 2px;
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      50.1%, 100% { opacity: 0; }
    }
    </style>
  </head>

  <body>
    <header class="header" data-header>
      <div class="container">
        <a href="#" class="logo ml-10 flex items-center space-x-3">
          <img
            src="../static/assets/footer/logo-2.png"
            width="55"
            height="20"
            alt=""
            class="logo-light"
          />
          <img
            src="../static/assets/footer/logo-2.png"
            width="55"
            height="20"
            alt=""
            class="logo-dark hidden"
          />
        </a>

        <nav class="navbar" data-navbar>
          <div class="navbar-top">
            <a href="#" class="logo">
              <img
                src="../static/assets/footer/logo-2.png"
                width="55"
                height="20"
                alt=""
              />
            </a>

            <button
              class="nav-close-btn"
              aria-label="close menu"
              data-nav-toggler
            >
              <ion-icon name="close-outline" aria-hidden="true"></ion-icon>
            </button>
          </div>

          <ul class="navbar-list">
            <li><a href="/" class="navbar-link">Beranda</a></li>
            <li><a href="/layanan" class="navbar-link">Layanan Kami</a></li>
            <li><a href="/tentang" class="navbar-link">Tentang Kami</a></li>
            <li><a href="/frequently" class="navbar-link">FAQs</a></li>
          </ul>

          <div class="wrapper">
            <a
              href="mailto:pelayanan.dukcapil9271@gmail.com"
              class="contact-link"
              >pelayanan.dukcapil 9271@gmail.com</a
            >
            <a href="tel:0812478660099" class="contact-link">0812 4786 60099</a>
          </div>

          <ul class="social-list" style="margin-bottom: 7em">
            <li>
              <a href="#" class="social-link"
                ><ion-icon name="logo-facebook"></ion-icon
              ></a>
            </li>
            <li>
              <a href="#" class="social-link"
                ><ion-icon name="logo-instagram"></ion-icon
              ></a>
            </li>
          </ul>
        </nav>

        <a href="#" class="btn btn-primary">Chat Bot</a>

        <button class="nav-open-btn" aria-label="open menu" data-nav-toggler>
          <ion-icon name="menu-outline" aria-hidden="true"></ion-icon>
        </button>

        <div class="overlay" data-nav-toggler data-overlay></div>
      </div>
    </header>

    <main>
      <article>
        <section class="min-h-screen flex items-center justify-center px-6 pt-40 pb-16 bg-gradient-to-b from-blue-200 via-white to-blue-100 animate-fade-in">
          <div class="w-full max-w-[1400px] flex flex-col lg:flex-row gap-10 animate-slide-up duration-500 ease-out">

            <!-- Kolom Chatbot -->
            <div class="lg:w-2/3 bg-white/60 backdrop-blur-xl border border-white/30 p-8 rounded-3xl shadow-xl flex flex-col gap-6">

              <!-- Header Chatbot -->
              <div class="flex items-center gap-4 p-4 bg-blue-600 text-white rounded-2xl shadow-md select-none">
                <i class="fa-solid fa-robot text-3xl"></i>
                <div>
                  <div class="flex items-center gap-2">
                    <span class="text-lg font-semibold">Chatbot DisdukCapil Kota Sorong</span>
                    <!-- Indikator Online -->
                    <span class="relative flex h-3 w-3">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                    </span>
                  </div>
                  <span class="text-xs text-green-200">Online</span>
                </div>
              </div>

              <!-- Chat Box -->
              <div id="chat-box" class="h-[550px] overflow-y-auto p-5 bg-gray-50/60 rounded-2xl shadow-inner flex flex-col gap-4 scroll-smooth border border-blue-100 transition-all">
                <!-- Pesan awal via JS -->
              </div>

              <!-- Input & Button -->
              <div class="flex flex-col sm:flex-row gap-3 items-stretch">
                <input type="text" id="user-input" placeholder="Tulis pesan Anda..."
                  class="flex-grow p-4 border border-gray-300 rounded-2xl outline-none transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 shadow-md bg-white/70 backdrop-blur-sm"
                  onkeydown="if(event.key==='Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }" />

                <button onclick="sendMessage()"
                  class="bg-blue-600 text-white px-6 py-3 rounded-2xl hover:bg-blue-800 transition transform hover:scale-105 active:scale-95 shadow-lg flex items-center gap-2">
                  <i class="fa-solid fa-paper-plane"></i>
                </button>

                <button onclick="resetChat()"
                  class="bg-gray-500 text-white px-6 py-3 rounded-2xl hover:bg-gray-700 transition transform hover:scale-105 active:scale-95 shadow-lg flex items-center gap-2">
                  <i class="fa-solid fa-rotate-right"></i>
                </button>
              </div>
            </div>

            <!-- Kolom Panduan Pengguna -->
            <div class="lg:w-1/3 bg-white/60 backdrop-blur-xl border border-white/30 p-8 rounded-3xl shadow-xl flex flex-col gap-4 h-fit">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-circle-info text-blue-600 text-3xl"></i>
                <h3 class="text-2xl font-bold text-blue-800">Panduan Pengguna</h3>
              </div>
              <ul class="flex flex-col gap-2 text-gray-800 text-lg leading-snug">
                <li class="flex items-start gap-2">
                  <i class="fa-solid fa-keyboard text-blue-600 mt-1"></i>
                  <span>Ketik pertanyaan atau pilih salah satu contoh pertanyaan di bawah.</span>
                </li>
                <li class="flex items-start gap-2">
                  <i class="fa-solid fa-language text-blue-600 mt-1"></i>
                  <span>Gunakan bahasa yang jelas dan singkat.</span>
                </li>
                <li class="flex items-start gap-2">
                  <i class="fa-solid fa-paper-plane text-blue-600 mt-1"></i>
                  <span>Tekan <b>Enter</b> atau klik <span class="bg-blue-100 px-2 py-0.5 rounded text-blue-700 font-semibold">ðŸ“© Kirim</span> untuk mengirim pesan.</span>
                </li>
                <li class="flex items-start gap-2">
                  <i class="fa-solid fa-rotate-right text-blue-600 mt-1"></i>
                  <span>Klik <span class="bg-gray-100 px-2 py-0.5 rounded text-gray-700 font-semibold">ðŸ”„ Reset</span> untuk menghapus riwayat percakapan.</span>
                </li>
                <li class="flex items-start gap-2">
                  <i class="fa-solid fa-clock text-blue-600 mt-1"></i>
                  <span>Chatbot aktif 24/7 memberikan informasi layanan Dukcapil Kota Sorong.</span>
                </li>
              </ul>

              <!-- Contoh Pertanyaan -->
              <div class="mt-4">
                <h4 class="text-xl font-semibold text-blue-700 mb-2">Contoh Pertanyaan:</h4>
                <ul class="list-disc list-inside flex flex-col gap-2 text-gray-800 text-lg leading-snug">
                  <li class="hover:text-blue-700 cursor-pointer" onclick="setExample('Bagaimana cara membuat KTP baru?')">
                    Bagaimana cara membuat KTP baru?
                  </li>
                  <li class="hover:text-blue-700 cursor-pointer" onclick="setExample('Apa saja syarat pembuatan akta kelahiran?')">
                    Apa saja syarat pembuatan akta kelahiran?
                  </li>
                  <li class="hover:text-blue-700 cursor-pointer" onclick="setExample('Jam berapa layanan Dukcapil buka?')">
                    Jam berapa layanan Dukcapil buka?
                  </li>
                  <li class="hover:text-blue-700 cursor-pointer" onclick="setExample('Bagaimana cara mengganti Kartu Keluarga yang hilang?')">
                    Bagaimana cara mengganti Kartu Keluarga yang hilang?
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </article>
    </main>

    <footer class="footer">
      <div class="container grid-list">
        <div class="footer-brand">
          <a href="#" class="logo">
            <img
              src="../static/assets/footer/logo-2.png"
              width="96"
              height="40"
              alt=""
            />
          </a>

          <p class="footer-text">
            &copy; 2025 Disduk Capil Kota Sorong. <br />
            All rights reserved.
          </p>

          <ul class="social-list">
            <li>
              <a href="#" class="social-link">
                <ion-icon name="logo-facebook"></ion-icon>
              </a>
            </li>

            <li>
              <a href="#" class="social-link">
                <ion-icon name="logo-instagram"></ion-icon>
              </a>
            </li>
          </ul>
        </div>

        <ul class="footer-list">
          <li>
            <p class="h4 footer-list-title">Alamat Kami</p>
          </li>

          <li>
            <address class="footer-text">
              Jl. Pramuka, Kota Sorong Provinsi Papua Barat Daya
            </address>
          </li>

          <li>
            <a
              href="mailto:pelayanan.dukcapil 9271@gmail.com"
              class="footer-link"
              >pelayanan.dukcapil 9271@gmail.com</a
            >
          </li>

          <li>
            <a href="tel:0812478660099" class="footer-link">0812 4786 60099</a>
          </li>
        </ul>

        <ul class="footer-list">
          <li>
            <p class="h4 footer-list-title">Navigasi Cepat</p>
          </li>

          <li>
            <a href="/" class="footer-link">Beranda</a>
          </li>

          <li>
            <a href="/tentang" class="footer-link">Tentang Kami</a>
          </li>

          <li>
            <a href="/layanan" class="footer-link">Layanan Kami</a>
          </li>

          <li>
            <a href="/frequently" class="footer-link">FAQs</a>
          </li>

          <li>
            <a href="/chatbot" class="footer-link">Chatbot Layanan</a>
          </li>
        </ul>

        <div class="footer-list">
          <p class="h4 footer-list-title">Peta Maps</p>

          <div
            class="relative w-full max-w-lg h-64 rounded overflow-hidden shadow-lg"
            style="margin-left: 0"
          >
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3989.3475241203255!2d131.28435837349804!3d-0.8802009353140464!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2d5954d661bac115%3A0xed01b7d89fb3a5e9!2sDinas%20Pencatatan%20Sipil%20Dan%20Kependudukan%20Kota%20Sorong!5e0!3m2!1sid!2sid!4v1743094828591!5m2!1sid!2sid"
              class="absolute top-0 left-0 w-full h-full border-0 rounded"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            ></iframe>
          </div>
        </div>
      </div>
    </footer>

    <script src="../static/assets/js/script.js"></script>

    <script>
  const sendSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
  const receiveSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
  sendSound.volume = 0.4;
  receiveSound.volume = 0.4;

  const initialResponse = `{{ initial_response | safe }}`;

  function formatTime() {
    const now = new Date();
    return now.toLocaleTimeString("id-ID", {
      hour: "2-digit",
      minute: "2-digit",
      timeZone: "Asia/Jakarta",
    });
  }

  function addMessage(content, sender, isTyping = false) {
    const chatBox = document.getElementById("chat-box");
    const time = formatTime();
    const wrapper = document.createElement("div");

    wrapper.classList.add(
      "message",
      "p-4",
      "rounded-2xl",
      "max-w-[85%]",
      "min-w-[50px]",
      "relative",
      "break-words",
      "select-text",
      "shadow-lg", // bayangan lebih lembut
      "flex",
      "items-center",
      "gap-3"
    );
    wrapper.style.fontFamily = "'Poppins', sans-serif";

    if (sender === "user") {
      wrapper.classList.add("bg-blue-600", "text-white", "self-end", "flex-row-reverse");
      wrapper.innerHTML = `
        <i class="fa-solid fa-user text-white text-2xl"></i>
        <span class="text-lg whitespace-pre-wrap leading-relaxed" style="text-align:justify">${content}</span>
        <time class="absolute text-xs opacity-60 bottom-1 left-3">${time}</time>`;
    } else {
      wrapper.classList.add("bg-gray-200", "text-gray-900", "self-start");
      wrapper.innerHTML = isTyping
        ? `<i class="fa-solid fa-robot text-blue-600 text-2xl"></i>
           <span class="flex items-center gap-1">
             <span class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></span>
             <span class="w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-150"></span>
             <span class="w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-300"></span>
           </span>`
        : `<i class="fa-solid fa-robot text-blue-600 text-2xl"></i>
           <span class="text-lg whitespace-pre-wrap leading-relaxed" style="text-align:justify">${content}</span>
           <time class="absolute text-xs opacity-60 bottom-1 right-3">${time}</time>`;
    }

    wrapper.id = isTyping ? "typing-indicator" : "";
    chatBox.appendChild(wrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function removeTyping() {
    const typingElem = document.getElementById("typing-indicator");
    if (typingElem) typingElem.remove();
  }

  function typeWriterEffect(text) {
    return new Promise((resolve) => {
      const chatBox = document.getElementById("chat-box");
      const time = formatTime();
      const wrapper = document.createElement("div");

      wrapper.classList.add(
        "message",
        "p-4",
        "rounded-2xl",
        "max-w-[85%]",
        "min-w-[50px]",
        "relative",
        "break-words",
        "select-text",
        "shadow-lg",
        "flex",
        "items-center",
        "gap-3",
        "bg-gray-200",
        "text-gray-900",
        "self-start"
      );
      wrapper.style.fontFamily = "'Poppins', sans-serif";

      const icon = document.createElement("i");
      icon.classList.add("fa-solid", "fa-robot", "text-blue-600", "text-2xl");

      const textElem = document.createElement("span");
      textElem.classList.add("text-lg", "whitespace-pre-wrap", "leading-relaxed", "typing-cursor");
      textElem.style.textAlign = "justify";

      const timeElem = document.createElement("time");
      timeElem.classList.add("absolute", "text-xs", "opacity-60", "bottom-1", "right-3");
      timeElem.textContent = time;

      wrapper.appendChild(icon);
      wrapper.appendChild(textElem);
      wrapper.appendChild(timeElem);

      chatBox.appendChild(wrapper);
      chatBox.scrollTop = chatBox.scrollHeight;

      let i = 0;
      let baseSpeed = 40;
      if (text.length > 200) baseSpeed = 15;
      if (text.length < 50) baseSpeed = 60;

      // ðŸ”Š Mainkan suara bot mulai mengetik
      receiveSound.currentTime = 0;
      receiveSound.play();

      function typeChar() {
        if (i < text.length) {
          textElem.textContent += text.charAt(i);
          i++;
          chatBox.scrollTop = chatBox.scrollHeight;
          setTimeout(typeChar, baseSpeed);
        } else {
          textElem.classList.remove("typing-cursor");
          resolve();
        }
      }
      typeChar();
    });
  }

  async function sendMessage() {
    const inputElem = document.getElementById("user-input");
    const userInput = inputElem.value.trim();
    if (!userInput) return;

    addMessage(userInput, "user");

    // ðŸ”Š Mainkan suara kirim pesan
    sendSound.currentTime = 0;
    sendSound.play();

    inputElem.value = "";
    inputElem.focus();

    addMessage("", "assistant", true);

    try {
      const response = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: userInput }),
      });

      const data = await response.json();
      removeTyping();
      await typeWriterEffect(data.response);
    } catch {
      removeTyping();
      addMessage("Maaf, terjadi kesalahan pada server.", "assistant");
    }
  }

  function showInitialGreeting() {
    if (typeof initialResponse !== "undefined" && initialResponse) {
      addMessage(initialResponse, "assistant");
    }
  }

  function resetChat() {
    document.getElementById("chat-box").innerHTML = "";
    document.getElementById("user-input").value = "";
    document.getElementById("user-input").focus();
    showInitialGreeting();
  }

  document.addEventListener("DOMContentLoaded", function () {
    showInitialGreeting();
  });

  function setExample(text) {
    document.getElementById("user-input").value = text;
    document.getElementById("user-input").focus();
  }
</script>

    <script
      type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
  </body>
</html>
